parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"FOZT":[function(require,module,exports) {
"use strict";function t(t){const r=Math.floor(t/1e3)%60,e=Math.floor(t/60/1e3)%60;return`${Math.floor(t/60/60/1e3).toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`}function r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var r=16*Math.random()|0;return("x"==t?r:3&r|8).toString(16)})}function e(t){let r=t.length;return 1===t.state&&(r=t.length-(Date.now()-t.timestamp+t.duration)),0===t.state&&t.duration>0&&(r=t.length-t.duration),r=Math.max(r,0)}function x(t,r){const e=[],x=[];for(let o of t){r.find(t=>t.id===o.id)||x.push(o)}for(let o of r){t.find(t=>t.id===o.id)||e.push(o)}return[e,x]}Object.defineProperty(exports,"__esModule",{value:!0}),exports.timeToString=t,exports.uuidv4=r,exports.getTimerTime=e,exports.getArrayDiff=x;
},{}],"u5uf":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("./utils.js");class e{onready(){}constructor(t){this.state=t,this.dbName="Timers",this.storeName="timers",this.version=1,this.db=null,this.initDatabase()}initDatabase(){const t=globalThis.indexedDB.open(this.dbName,this.version);t.onerror=(t=>{console.error("Database error:",t.target.error.name+":",t.target.error.message)}),t.onupgradeneeded=(t=>{const e=t.target.result,s=e.createObjectStore(this.storeName,{keyPath:"id"}),r={length:"length",title:"title",timestamp:"timestamp",state:"state",duration:"duration"};s.createIndex("id","id",{unique:!0});for(let a in r)s.createIndex(a,r[a],{unique:!1});s.transaction.oncomplete=(t=>{const s=e.transaction(this.storeName,"readwrite").objectStore(this.storeName);this.state.timers.forEach(t=>{s.add(t)})})}),t.onsuccess=(t=>{this.db=t.target.result,r.onerror=(t=>{console.error("Database error: "+t.target.errorCode)}),this.onready()})}startTransation(t=(()=>{})){const e=this.db.transaction([this.storeName],"readwrite");return e.oncomplete=(e=>{t()}),e.onerror=(e=>{t(e)}),e}async getTimers(){return new Promise((t,e)=>{const s=this.startTransation().objectStore(this.storeName).getAll();s.onerror=(t=>{e(t)}),s.onsuccess=(e=>{t(s.result)})})}async deleteTimer(t,e){return new Promise((e,s)=>{const r=this.startTransation().objectStore(this.storeName).delete(t);r.onsuccess=(t=>{e()}),r.onerror=(t=>{s(t)})})}addTimer(t){this.startTransation().objectStore(this.storeName).add(t)}async saveTimers(){return new Promise(async(t,e)=>{const s=this.startTransation().objectStore(this.storeName);for(let r of this.state.timers){const t=s.put(r);t.onerror=(t=>{console.error(t.target.error)}),t.onsuccess=(t=>{})}})}}const s={currentTimer:null,timers:[]},r=new e(s);r.onready=(()=>{globalThis.addEventListener("statechange",e=>{r.getTimers().then(e=>{const a=(0,t.getArrayDiff)(s.timers,e),i=a[0],n=a[1];for(let t of i)r.deleteTimer(t.id);for(let t of n)r.addTimer(t)})}),r.getTimers().then(t=>{s.timers=t,i.setState(s)})});class a extends Event{constructor(t){super("timer.finished"),this.timer=t}}setInterval(async()=>{const e=await i.getState();for(let r of e.timers){if((0,t.getTimerTime)(r)<=0&&1==r.state){r.state=0,i.setState(s);const t=new a(r);globalThis.dispatchEvent(t)}}globalThis.dispatchEvent(new Event("tick"))},1e3);class i{static setState(t){globalThis.parent==globalThis.parent&&r.saveTimers(),globalThis.dispatchEvent(new Event("statechange"))}static async getState(){return Object.assign(s,{timers:await r.getTimers()})}static async createTimer(e={length:6e4,title:"Timer",timestamp:0,state:0,duration:0}){const s=await this.getState();e.id=(0,t.uuidv4)(),s.timers.push(e),this.setState(s)}static async updateTimer(t,e){const s=await this.getState(),r=await this.getTimerById(t),a=s.timers.indexOf(r);s.timers[a]=Object.assign(r,e),this.setState(s)}static async deleteTimer(t){const e=await this.getTimerById(t),s=await this.getState();s.timers.splice(s.timers.indexOf(e),1),this.setState(s)}static async startTimer(t){const e=await this.getTimerById(t);e.timestamp=Date.now(),e.state=1,this.setState(s)}static async stopTimer(t){const e=await this.getTimerById(t);e.duration=Date.now()-e.timestamp,e.state=0,this.setState(s)}static async resetTimer(t){const e=await this.getTimerById(t);e.duration=0,e.timestamp=Date.now(),this.setState(s)}static async getTimerById(t){return(await this.getState()).timers.find(e=>e.id==t)}}exports.default=i;
},{"./utils.js":"FOZT"}],"NqYy":[function(require,module,exports) {
"use strict";var e=t(require("./State.js"));function t(e){return e&&e.__esModule?e:{default:e}}function i(e){self.registration.showNotification("Timers",{body:`Timer "${e.title}" is done.`,vibrate:!0,requireInteraction:!0,actions:[{action:"stop",title:"Stop"}]}),self.addEventListener("notificationclick",e=>{e.notification.close()},!1)}self.addEventListener("install",e=>{e.waitUntil(caches.open("timers-cache").then(e=>e.addAll(["./","./index.html","./main.css","./main.js"])))}),self.addEventListener("fetch",e=>{e.respondWith(caches.match(e.request).then(t=>t||fetch(e.request)))}),self.addEventListener("activate",e=>{globalThis.addEventListener("timer.finished",e=>{console.log(e),i(e.timer)})});
},{"./State.js":"u5uf"}]},{},["NqYy"], null)
//# sourceMappingURL=sw.js.map